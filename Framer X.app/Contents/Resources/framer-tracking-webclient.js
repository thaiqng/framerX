!function(e,t){for(var n in t)e[n]=t[n]}(window,function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1);t.FramerTracking=s.FramerTracking,t.framerTracking=function({sourceName:e,trackingUrl:t}){return new s.FramerTracking({sourceName:e,trackingURL:t})}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))(function(o,i){function r(e){try{c(s.next(e))}catch(t){i(t)}}function u(e){try{c(s.throw(e))}catch(t){i(t)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,u)}c((s=s.apply(e,t||[])).next())})},o=this&&this.__rest||function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&(n[s[o]]=e[s[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});const i=n(2);function r(){const e=()=>Math.floor(65536*(1+Math.random())).toString(16).slice(-4);return`${e()}${e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`}t.FramerTracking=class u{constructor(e){this.sourceName=e.sourceName,this.userId=e.userId,this.verbose=e.verbose||!1,this.addContext=e.addContext,this.poster=i.createPoster({endpointURL:e.trackingURL,postBatch:e.postBatch,storeId:e.storeId,processItem:e=>e.data.context.userId?e:this.userId?(e.data.context.userId=this.userId,e):null})}flush(){return s(this,void 0,void 0,function*(){yield this.poster.flush()})}group(e){this.post(Object.assign({},e,{type:"group"}))}identify(e){this.post(Object.assign({},e,{type:"identify"}))}track(e){if(this.verbose){const{event:t,type:n}=e,s=o(e,["event","type"]);this.logEvent(t,s)}this.post(Object.assign({},e,{type:"track"}))}setUserId(e){this.userId&&this.userId!==e&&console.warn("Changing user id from %s to %s",this.userId,e),this.userId=e,this.poster.reprocessItems()}logEvent(e,t){let n=`%c${e}`;const s=["background: blue; border-radius: 3px; color: white; padding: 0 5px;"];t&&Object.keys(t).length>0&&(n+=`\n%c${JSON.stringify(t,null,2)}`,s.push("font-family: monospace; opacity: 0.7;")),console.log(n,...s)}post(e){if(!this.userId){const t="identify"===e.type?e.userId:e.context&&e.context.userId;t&&this.setUserId(t)}const t=Object.assign({},e.context);"undefined"!=typeof window&&(t.language||(t.language=window.navigator.language),t.screen||(t.screen={width:window.screen.width,height:window.screen.height})),this.addContext&&this.addContext(t);const n={data:Object.assign({},e,{context:t,uuid:e.uuid||r()}),source:this.sourceName,timestamp:Date.now()};this.poster.post(n)}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))(function(o,i){function r(e){try{c(s.next(e))}catch(t){i(t)}}function u(e){try{c(s.throw(e))}catch(t){i(t)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,u)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3);t.createPoster=function(e){return new a(e)};const i=1e3,r=1e4,u=100,c=4,h=1e3;class a{constructor(e){this.failCount=0,this.endpointURL=e.endpointURL,this.processItem=e.processItem,null!==e.storeId?(this.store=o.createStore(e.storeId||"framer-tracking-client-queue"),this.queue=this.store.load()):this.queue=[],this.postBatch=e.postBatch||("undefined"!=typeof window&&window.fetch?Promise.resolve().then(()=>n(4)).then(e=>e.postBatch):Promise.resolve().then(()=>n(!function(){var e=new Error("Cannot find module './postBatch@node'");throw e.code="MODULE_NOT_FOUND",e}())).then(e=>e.postBatch))}flush(){return s(this,void 0,void 0,function*(){if(this.pendingFlushPromise){try{yield this.pendingFlushPromise}catch(n){}return 0===this.queue.length}clearTimeout(this.flushTimer),clearTimeout(this.flushDeadlineTimer),this.flushTimer=this.flushDeadlineTimer=void 0;const e=this.buildPostBody();if(!e)return!0;const t=Promise.all([this.postBatch,this.endpointURL]).then(([t,n])=>t(n,e));this.pendingFlushPromise=t;try{yield t,this.failCount=0,this.queue=this.queue.filter(e=>!e.pending),this.store&&this.store.save(this.queue),this.queue.length>0&&!this.flushTimer&&this.scheduleFlush()}catch(n){console.warn("Post failed: %s",n);for(const e of this.queue)e.pending&&(e.pending=!1);this.failCount++,this.scheduleFlush()}finally{this.pendingFlushPromise=void 0}return 0===this.queue.length})}post(e){const t=this.createQueueItem(e);this.queue.push(t),this.constrainQueueSize(),this.store&&this.store.save(this.queue),this.scheduleFlush()}reprocessItems(e=!1){let t=!1;for(const n of this.queue)n.complete||this.tryCompleteItem(n)&&(t=!0);this.store&&(e||t)&&this.store.save(this.queue)}buildPostBody(){const e=["[\n"];let t=0;for(let n=0;n<this.queue.length;n++){const s=this.queue[n];if(this.tryCompleteItem(s)&&(t>0&&e.push(",\n"),e.push(s.json),s.pending=!0,++t===u))break}return 0===t?"":(e.push("\n]"),e.join(""))}constrainQueueSize(){if(this.queue.length<=h)return;const e=this.queue.length-h;this.queue.splice(e),console.warn("Dropping %d item(s) from the queue",e)}createQueueItem(e){if(!this.processItem)return{complete:!0,json:JSON.stringify(e)};try{const n=this.processItem(e);return n?{complete:!0,json:JSON.stringify(n)}:{cache:e,complete:!1,json:JSON.stringify(e)}}catch(t){const n=JSON.stringify(e);return console.warn("Failed to process item (%s): %s",t.message,n),{cache:e,complete:!1,json:n}}}scheduleFlush(){const e=()=>this.flush();this.flushDeadlineTimer||(this.flushDeadlineTimer=setTimeout(e,this.withBackoff(r))),clearTimeout(this.flushTimer),this.flushTimer=setTimeout(e,this.withBackoff(i))}tryCompleteItem(e){if(e.complete)return!0;if(!this.processItem)return!1;try{const n=e.cache||JSON.parse(e.json),s=this.processItem(n);if(!s)return e.cache=n,!1;e.cache=void 0,e.complete=!0,e.json=JSON.stringify(s)}catch(t){return console.warn("Failed to process item (%s): %s",t.message,e),!1}return!0}withBackoff(e){return this.failCount?e*Math.pow(2,Math.min(this.failCount,c)):e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createStore=function(e){return new s(e)};class s{constructor(e){this.id=e}load(){const e=this.getLocalStorageSafely();if(!e)return[];const t=e.getItem(this.id);return t?t.split("\n").map(e=>e&&"!"===e[0]?{complete:!1,json:e.slice(1)}:{complete:!0,json:e}):[]}save(e){const t=this.getLocalStorageSafely();if(!t)return;const n=e.map(e=>(e.complete?"":"!")+e.json).join("\n");t.setItem(this.id,n)}getLocalStorageSafely(){try{if("undefined"==typeof window||!window.localStorage)return null}catch(e){return null}return window.localStorage}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))(function(o,i){function r(e){try{c(s.next(e))}catch(t){i(t)}}function u(e){try{c(s.throw(e))}catch(t){i(t)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,u)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.postBatch=function(e,t){return s(this,void 0,void 0,function*(){const n=yield fetch(e,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"},body:t});if(!n.ok)throw Error(`Server responded with ${n.statusText}`);"opaque"!==n.type&&(yield n.json())})}}]));
//# sourceMappingURL=framer-tracking-webclient.js.map